---
title: "åœ¨ Hugo åšå®¢ä¸Šä½¿ç”¨ PlantUML"
date: 2020-05-15T18:48:58+02:00
draft: false
tags: ["hugo", "mogege"]
categories: ["æŠ˜è…¾åšå®¢çš„äºŒä¸‰äº‹ "]
image: 
subtitle: 
plantuml: true
---
<!-- 
![](https://mogeko.github.io/blog-images/r/083/)
{{< spoiler >}}{{< /spoiler >}}
&emsp;&emsp;
plaintext
 -->

PlantUML æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å¼€æºå·¥å…·ï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„æ–‡å­—æè¿°ç”Ÿæˆ**æ—¶åºå›¾ï¼Œç”¨ä¾‹å›¾ï¼Œç±»å›¾ï¼Œæ´»åŠ¨å›¾ï¼Œç»„ä»¶å›¾ï¼ŒçŠ¶æ€å›¾ï¼Œå¯¹è±¡å›¾ï¼Œéƒ¨ç½²å›¾ ...** ç­‰å¸¸ç”¨ UML å›¾ã€‚

æˆ‘å†™åšå®¢çš„æ—¶å€™æœ‰æ—¶å€™ä¹Ÿä¼šç”¨åˆ° UML å›¾ï¼Œç‰¹åˆ«æ˜¯æŠ€æœ¯æ€§æ–‡ç« æ—¶ï¼Œä½† Hugo é»˜è®¤ä¸æ”¯æŒ PlantUMLï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ Hugo ä¸»é¢˜æ”¯æŒ PlantUMLã€‚

**æˆ‘å¼€å‘çš„ [mogege](https://github.com/Mogeko/mogege#plantuml) ä¸»é¢˜å·²ç»å®ç°äº†å¯¹ PlantUML çš„æ”¯æŒï¼Œå¯ä»¥ç›´æ¥ç”¨**

## å¼€å‘è¿‡ç¨‹

æ”¯æŒ PlantUML çš„å¼€å‘è¿‡ç¨‹å¯è°“æ˜¯ä¸€æ³¢ä¸‰æŠ˜ï¼Œä¸è®°å½•ä¸‹æ¥å¯¹ä¸èµ·æˆ‘ç‰ºç‰²çš„è„‘ç»†èƒï¼Œä¸æƒ³çœ‹æˆ‘å•°å—¦çš„[æˆ³è¿™é‡Œ](#åœ¨-hugo-ä¸»é¢˜ä¸­å®ç°)

é¦–å…ˆï¼Œæˆ‘å…ˆæœç´¢äº†ä¸€ä¸‹ï¼Œçœ‹æœ‰æ²¡æœ‰å·²ç»é€ å¥½äº†çš„è½®å­ã€‚ç„¶åå‘ç°å·²ç»æœ‰äººç»™ Hugo ä¸»é¢˜ [Academic](https://github.com/gcushen/hugo-academic) çš„ä½œè€…æè¿‡[å¸Œæœ›æ”¯æŒ PlantUML çš„å»ºè®®](https://github.com/gcushen/hugo-academic/issues/1110)äº†ã€‚çœ‹å®Œé‚£ç¯‡ Issue åå¿ƒç¬é—´å‡‰äº†ä¸€åŠã€‚Academic çš„ä½œè€…è§‰å¾— PlantUML éœ€è¦ä¾èµ– Hugo ä»¥å¤–çš„è½¯ä»¶ï¼Œè¿™ä¸ªè½¯ä»¶è¿˜æ˜¯åŸºäº Java å¼€å‘çš„ï¼Œæ“ä½œèµ·æ¥å¤ªå¤æ‚äº†ï¼Œæ‰€ä»¥æ‹’ç»äº†å»ºè®®

> Closing as PlantUML is not client side JS, also it's not currently  supported by Hugo even if PlantUML has been manually installed locally: [gohugoio/hugo#796](https://github.com/gohugoio/hugo/issues/796).
>
> The recommendations for diagramming can be found here: <https://sourcethemes.com/academic/docs/writing-markdown-latex/#diagrams>
>
> Also, I have opened [#1111](https://github.com/gcushen/hugo-academic/issues/1111) to consider integrating Mermaid.js for generating diagrams.

å°±åœ¨æˆ‘å‡†å¤‡æ”¾å¼ƒæ—¶ï¼Œçœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š[Markdown native diagrams with PlantUML](https://blog.anoff.io/2018-07-31-diagrams-with-plantuml/)

è¿™ç¯‡æ–‡ç« ä»‹ç»äº† [PlantUML å®˜æ–¹çš„ Online Server](http://www.plantuml.com/plantuml/uml/SyfFKj2rKt3CoKnELR1Io4ZDoSa70000)ï¼Œè¯¥æœåŠ¡å™¨æä¾› RESTful APIï¼Œä½ åªéœ€è¦å°† PlantUML ä»£ç ç¼–ç ï¼Œç„¶åå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ¸²æŸ“å¥½çš„ PNG æˆ– SVG å›¾ç‰‡ã€‚VSCode çš„ [PlantUML æ‰©å±•](https://marketplace.visualstudio.com/items?itemName=jebbs.plantuml)å°±æ˜¯åŸºäºè¿™ä¸ªæ–¹æ¡ˆå®ç°çš„ã€‚

è¿™ç§ç¼–ç ç±»ä¼¼äº (ä½†ä¸æ˜¯) Base64 ç¼–ç ã€‚æˆ‘ä»¬åªéœ€è¦ç”¨ JavaScript æ•æ‰å¹¶ç¼–ç  PlantUML ä»£ç å—ï¼Œç„¶åå‘é€ç»™ PlantUML å®˜æ–¹çš„ Online Serverï¼Œå†å°†è¿”å›çš„ SVG å›¾ç‰‡æ’å…¥åˆ° DOM æ ‘ä¸­å°±å¯ä»¥äº†ã€‚æµç¨‹å¦‚å›¾ï¼š

```plantuml
@startuml
actor You
"You" --> "Blog": View post
"Blog" -> "PlantUML Server": Encoded PlantUML syntax
"PlantUML Server" -> "Blog": Get URL of SVG/PNG image
"Blog" --> "You": Show pictures in the post
@enduml
```

(ğŸ‘†è¿™å¼ å›¾å°±æ˜¯é€šè¿‡ PlantUML Server å®æ—¶ç”Ÿæˆçš„)

å®˜æ–¹ä¹Ÿä¸ºè¿™ç§ç”¨æ³•ç»™å‡ºäº†ä¸€ä¸ª[å‚è€ƒå®ç°](https://plantuml.com/zh/code-javascript-synchronous)ã€‚æ‰€ä»¥ç°åœ¨åªéœ€è¦å» NPM ä¸Šæ‰¾ä¸€ä¸ªè½®å­å°±å¥½äº†ã€‚æ‰“å¼€ NPM ä¸€æœï¼Œæœç„¶æœ‰ä¸å°‘è½®å­ï¼Œä½†å‡ ä¹æ‰€æœ‰å®ç°éƒ½æ˜¯åŸºäº Node.js çš„ï¼Œæ²¡æœ‰ä¸€ä¸ªå¯ä»¥ç”¨çš„ QAQ

![NPM Search](https://mogeko.github.io/blog-images/r/083/npm_search.png)

å°±åœ¨æˆ‘åˆåŒå’å‡†å¤‡æ”¾å¼ƒæ—¶ï¼Œç»ˆäºåœ¨äº’è”ç½‘çš„å¡å¡è§’è§’é‡Œæ‰¾åˆ°äº†è¿™ä¸ªåº“ [jmnote/plantuml-encoder](https://github.com/jmnote/plantuml-encoder)

ç»ˆäºå¯ä»¥å¼€å·¥äº† \_(:Ğ·ã€âˆ )\_

## åœ¨ Hugo ä¸»é¢˜ä¸­å®ç°

å®ç°å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ä¸»é¢˜å¼•ç”¨ JavaScriptçš„åœ°æ–¹ (æˆ‘çš„æ˜¯ `./layouts/partials/js.html`) æ’å…¥ï¼š

```html
{{ if or .Page.Params.plantuml .Site.Params.plantuml }}
<!-- PlantUML -->
<script src="https://cdn.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js" integrity="sha256-Qsk2KRBCN5qVZX7B+8+2IvQl1Aqc723qV1tBCQaVoqo=" crossorigin="anonymous"></script>
<script>
(function(){
  let plantumlPrefix = "language-plantuml";
  Array.prototype.forEach.call(document.querySelectorAll("[class^=" + plantumlPrefix + "]"), function(code){
    let image = document.createElement("IMG");
    image.loading = 'lazy'; // Lazy loading
    image.src = 'http://www.plantuml.com/plantuml/svg/~1' + plantumlEncoder.encode(code.innerText);
    code.parentNode.insertBefore(image, code);
    code.style.display = 'none';
  });
})();
</script>
{{ end }}
```

ç¬¬ä¸€è¡Œçš„ `{{ if or .Page.Params.plantuml .Site.Params.plantuml }}` ç›¸å½“äºä¸¤ä¸ªå¼€å…³ï¼Œåˆ†åˆ«æ§åˆ¶ PlantUML åœ¨**å…¨å±€**å’Œ**å•ä¸ªæ–‡ç« å†…**å¼€å¯ä¸å¦ (é»˜è®¤æ˜¯å…³é—­çš„)

å…¨å±€å¼€å¯ PlantUML éœ€è¦åœ¨ `config.toml` ä¸­é…ç½®ï¼š

```toml
[params]
  plantuml = true
```

å¦‚æœéœ€è¦ä¸ºå•ä¸ªé¡µé¢å¼€å¯ï¼Œåˆ™åœ¨æ–‡ç« å¼€å¤´çš„é…ç½®åŒºæ·»åŠ 

```yml
plantuml: true
```

ç„¶åå†æ–‡ç« ä¸­ä½¿ç”¨ <code>&#96;&#96;&#96;plantuml</code> æ ‡è®°éœ€è¦è¢«æ¸²æŸ“çš„ PlantUML è¯­æ³•å—

```markdown
â€‹```plantuml
PlantUML è¯­æ³•å—
â€‹```
```

## æ•ˆæœå¦‚ä¸‹

```plaintext
â€‹```plantuml
@startuml
Alice -> Bob: Authentication Request
Bob --> Alice: Authentication Response

Alice -> Bob: Another authentication Request
Alice <-- Bob: Another authentication Response
@enduml
â€‹```
```

```plantuml
@startuml
Alice -> Bob: Authentication Request
Bob --> Alice: Authentication Response

Alice -> Bob: Another authentication Request
Alice <-- Bob: Another authentication Response
@enduml
```
